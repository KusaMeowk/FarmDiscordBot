# Enhanced Economic Scenarios - Integration Guide

## üîß Setup

### 1. Install Dependencies
```bash
# ƒê√£ c√≥ s·∫µn trong requirements.txt
pip install discord.py aiofiles python-dotenv
```

### 2. Generate Cache
```bash
python generate_enhanced_cache.py
```

### 3. Integration v√†o Bot
```python
# Trong bot.py ho·∫∑c main file
from ai.hourly_scenario_updater import HourlyScenarioUpdater
from ai.gemini_economic_manager import GeminiEconomicManager

# Setup trong bot setup
async def setup_enhanced_scenarios(bot):
    gemini_manager = GeminiEconomicManager(bot.db)
    scenario_updater = HourlyScenarioUpdater(bot, gemini_manager)
    
    # Kh·ªüi ƒë·ªông updater
    await scenario_updater.start_updater()
    
    # Store reference
    bot.scenario_updater = scenario_updater
    
    print("‚úÖ Enhanced Economic Scenarios initialized")
```

## üéØ Usage Examples

### 1. Manual Cache Generation
```python
from ai.enhanced_economic_scenarios import EnhancedEconomicScenarios

generator = EnhancedEconomicScenarios()

# T·∫°o scenarios cho gi·ªù hi·ªán t·∫°i
hourly_scenarios = generator.generate_hourly_scenarios({})

# T·∫°o cache to√†n di·ªán
full_cache = generator.create_comprehensive_cache()
```

### 2. Get Scenarios by Context
```python
# L·∫•y scenario ph√π h·ª£p v·ªõi t√¨nh h√¨nh hi·ªán t·∫°i
scenario = generator.get_random_scenario_for_state(
    economic_health=0.7,
    activity=0.8, 
    weather="sunny",
    time_period="afternoon"
)
```

### 3. Integration v·ªõi Gemini
```python
# Trong Gemini Economic Manager
from ai.smart_cache import SmartCache

cache = SmartCache()
await cache.load_from_disk()

# Check cache tr∆∞·ªõc khi call API
cached_decision = await cache.get_cached_decision(economic_data, weather_data)
if cached_decision:
    return cached_decision
else:
    # Call Gemini API
    decision = await self.call_gemini_api(prompt)
    # Save v√†o cache
    await cache.save_decision(economic_data, weather_data, decision)
    return decision
```

## üìä Monitoring

### Cache Stats
```python
stats = cache.get_stats()
print(f"Hit rate: {stats['hit_rate']}")
print(f"Tokens saved: {stats['tokens_saved']}")
print(f"Cost saved: {stats['cost_saved']}")
```

### Scenario Types Distribution
```python
updater = bot.scenario_updater
status = updater.get_status()
print(f"Last update: {status['last_update']}")
print(f"Total updates: {status['update_count']}")
```

## üé™ Events Integration

### Auto-trigger Events
```python
# Scenarios c√≥ th·ªÉ t·ª± ƒë·ªông trigger events
event_scenarios = [
    s for s in scenarios.values()
    if s['decision']['action_type'] == 'EVENT_TRIGGER'
]

for scenario in event_scenarios:
    params = scenario['decision']['parameters']
    if params.get('event_name'):
        # Trigger event trong game
        await trigger_game_event(params)
```

## üå§Ô∏è Weather Integration

### Sync v·ªõi Weather System  
```python
# Weather scenarios ·∫£nh h∆∞·ªüng th·ªùi ti·∫øt game
weather_scenarios = [
    s for s in scenarios.values() 
    if s['decision']['action_type'] in ['WEATHER_CHANGE', 'WEATHER_ENHANCEMENT']
]

for scenario in weather_scenarios:
    weather_type = scenario['decision']['parameters'].get('weather_type')
    if weather_type:
        await update_game_weather(weather_type)
```

## üîÑ Customization

### Th√™m Scenarios M·ªõi
```python
# Extend scenario generator
class CustomEconomicScenarios(EnhancedEconomicScenarios):
    def _create_custom_scenarios(self):
        return [
            EconomicScenario(
                pattern="custom-pattern",
                name="Custom Event",
                description="My custom scenario",
                # ... other fields
            )
        ]
    
    def _create_scenario_database(self):
        scenarios = super()._create_scenario_database()
        scenarios.extend(self._create_custom_scenarios())
        return scenarios
```

### Configure Update Interval
```python
# Thay ƒë·ªïi t·∫ßn su·∫•t update
updater.update_interval_hours = 2  # Update m·ªói 2 gi·ªù
updater.max_scenarios_per_update = 30  # T·ªëi ƒëa 30 scenarios/update
```

## üö® Troubleshooting

### Cache Issues
```bash
# Reset cache
rm cache/smart_cache.json
python generate_enhanced_cache.py
```

### Memory Issues
```python
# Limit cache size
await cache.cleanup_old()  # Manual cleanup
updater.scenario_expiry_hours = 12  # Expire sau 12 gi·ªù
```

### Integration Issues
```python
# Check integration status
status = updater.integration_status
print(f"Weather sync: {status['weather_sync']}")
print(f"Event sync: {status['event_sync']}")
print(f"Gemini sync: {status['gemini_sync']}")
```

---
*Generated by Enhanced Economic Scenarios Integration Guide*
