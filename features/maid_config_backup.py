# Maid System Configuration
"""
üñºÔ∏è AVATAR REQUIREMENTS - 3:4 Aspect Ratio (Portrait Mode):
- UR Maids: 750x1000 pixels (Premium quality)
- SSR Maids: 600x800 pixels (High quality)  
- SR/R Maids: 480x640 pixels (Standard quality)
- Format: PNG preferred, JPG/WEBP acceptable
- File size: < 8MB (Discord limit)
- Hosting: Imgur recommended (https://i.imgur.com/image_id.png)
"""
import random
from typing import Dict, List, Any

# Gacha Configuration
GACHA_CONFIG = {
    "single_roll_cost": 10000,      # 10k coins/roll
    "ten_roll_cost": 90000,         # 90k coins/10 rolls (10% discount)
    "pity_threshold": None,         # No pity system
    "guaranteed_ur_rolls": None     # No pity system
}

# Rarity Configuration v·ªõi Individual Maid Rates
RARITY_CONFIG = {
    "GR": {
        "buff_count": 3,
        "buff_range": (50, 70),    # % buff power - HIGHEST tier
        "total_rate": 0.01,        # 0.01% total rate cho GR (rarest)
        "maid_count": 2,           # 2 GR maids (Jalter + Kotori)
        "individual_rate": 0.01/2, # 0.005% per GR maid (exclusive trong limited banner)
        "color": 0xDC143C          # M√†u ƒë·ªè t∆∞∆°i
    },
    "UR": {
        "buff_count": 2,
        "buff_range": (35, 50),    # % buff power - REDUCED from 50-70
        "total_rate": 0.1,         # 0.1% total rate cho UR
        "maid_count": 6,           # 6 UR maids (excluding Jalter - now GR)
        "individual_rate": 0.1/6,  # 0.0167% per UR maid
        "color": 0xFF6B9D          # M√†u h·ªìng
    },
    "SSR": {
        "buff_count": 1,
        "buff_range": (20, 35),
        "total_rate": 5.9,         # 5.9% total rate cho SSR
        "maid_count": 10,          # 10 SSR maids
        "individual_rate": 5.9/10, # 0.59% per SSR maid
        "color": 0xFFD700          # M√†u v√†ng
    },
    "SR": {
        "buff_count": 1,
        "buff_range": (15, 25),
        "total_rate": 24.0,        # 24% total rate cho SR
        "maid_count": 15,          # 15 SR maids
        "individual_rate": 24.0/15, # 1.6% per SR maid
        "color": 0xC0C0C0          # M√†u b·∫°c
    },
    "R": {
        "buff_count": 1,
        "buff_range": (5, 15),
        "total_rate": 70.0,        # 70% total rate cho R
        "maid_count": 19,          # 19 R maids
        "individual_rate": 70.0/19, # 3.68% per R maid
        "color": 0xCD7F32          # M√†u ƒë·ªìng
    }
}

# Stardust Configuration
STARDUST_CONFIG = {
    "dismantle_rewards": {
        "GR": 200,      # T√°ch GR = 200 b·ª•i sao (highest reward)
        "UR": 100,      # T√°ch UR = 100 b·ª•i sao
        "SSR": 50,      # T√°ch SSR = 50 b·ª•i sao  
        "SR": 25,       # T√°ch SR = 25 b·ª•i sao
        "R": 10,        # T√°ch R = 10 b·ª•i sao
    },
    "reroll_costs": {
        "GR": 150,      # Reroll GR maid = 150 b·ª•i sao (premium cost)
        "UR": 80,       # Reroll UR maid = 80 b·ª•i sao
        "SSR": 40,      # Reroll SSR maid = 40 b·ª•i sao
        "SR": 20,       # Reroll SR maid = 20 b·ª•i sao
        "R": 8          # Reroll R maid = 8 b·ª•i sao
    }
}

# Multi-Banner Configuration  
BANNER_CONFIGS = {
    "jalter": {
        "banner_name": "Dragon Witch Festival",
        "featured_character": "jalter_gr",
        "single_roll_cost": 12000,
        "ten_roll_cost": 108000,
        "banner_description": "üî• Dragon Witch Jeanne d'Arc Alter ra m·∫Øt! Ghost Rare debut + Rate-up featured!",
        "background_color": 0xFF4500,  # M√†u cam ƒë·ªè cho theme r·ªìng l·ª≠a
        "theme_emoji": "üî•"
    },
    "kotori": {
        "banner_name": "Spirit Sister Festival", 
        "featured_character": "kotori_gr",
        "single_roll_cost": 12000,
        "ten_roll_cost": 108000,
        "banner_description": "üç° Date A Live - Kotori Itsuka c√¥ em g√°i ƒë√°ng y√™u ra m·∫Øt!",
        "background_color": 0xDC143C,  # M√†u ƒë·ªè t∆∞∆°i cho Kotori
        "theme_emoji": "üç°"
    }
}

# Active Banner State (Admin c√≥ th·ªÉ thay ƒë·ªïi)
ACTIVE_BANNER_CONFIG = {
    "enabled": False,               # Banner c√≥ ƒëang active kh√¥ng
    "current_banner": "kotori",     # Banner hi·ªán t·∫°i: "jalter" ho·∫∑c "kotori"
    "start_time": None,             # Th·ªùi gian b·∫Øt ƒë·∫ßu
    "end_time": None                # Th·ªùi gian k·∫øt th√∫c
}

# Legacy config ƒë·ªÉ backward compatibility
LIMITED_BANNER_CONFIG = {
    "enabled": False,
    "banner_name": "Spirit Sister Festival",
    "single_roll_cost": 12000,
    "ten_roll_cost": 108000,
    "featured_rate_up": 2.0,
    "ur_rate_boost": 0.1,
    "ssr_rate_boost": 2.0,
    "banner_description": "üç° Date A Live - Kotori Itsuka c√¥ em g√°i ƒë√°ng y√™u ra m·∫Øt!",
    "background_color": 0xDC143C,
    "start_time": None,
    "end_time": None
}

# Limited Banner Rates (khi enabled)
LIMITED_RARITY_CONFIG = {
    "GR": {
        "total_rate": 0.05,        # 0.05% Ghost Rare rate trong limited banner  
        "featured_rate": 0.05,     # 100% c·ªßa GR rate cho featured (Jalter)
        "other_rate": 0.0,         # Kh√¥ng c√≥ GR kh√°c
        "color": 0x8B00FF          # M√†u t√≠m ma qu√°i
    },
    "UR": {
        "total_rate": 0.15,        # Gi·∫£m t·ª´ 0.2% xu·ªëng 0.15% (ƒë·ªÉ nh∆∞·ªùng ch·ªó cho GR)
        "featured_rate": 0.0,      # Kh√¥ng c√≥ UR featured n·ªØa
        "other_rate": 0.15,        # T·∫•t c·∫£ cho UR th∆∞·ªùng (exclude limited-only)
        "color": 0xFF1493          # Deep pink cho limited UR
    },
    "SSR": {
        "total_rate": 7.9,         # TƒÉng t·ª´ 5.9% l√™n 7.9%
        "featured_rate": 0.0,      # Kh√¥ng c√≥ SSR featured
        "other_rate": 7.9,         # T·∫•t c·∫£ cho SSR th∆∞·ªùng
        "color": 0xFFD700
    },
    "SR": {
        "total_rate": 22.1,        # ƒêi·ªÅu ch·ªânh ƒë·ªÉ c√¢n b·∫±ng t·ªïng = 100%
        "featured_rate": 0.0,
        "other_rate": 22.1,
        "color": 0xC0C0C0
    },
    "R": {
        "total_rate": 69.8,        # ƒêi·ªÅu ch·ªânh ƒë·ªÉ c√¢n b·∫±ng t·ªïng = 100%
        "featured_rate": 0.0,
        "other_rate": 69.8,
        "color": 0xCD7F32
    }
}

# Buff Types
BUFF_TYPES = {
    "growth_speed": {
        "name": "üå± TƒÉng T·ªëc Sinh Tr∆∞·ªüng",
        "description": "Gi·∫£m th·ªùi gian tr·ªìng c√¢y",
        "emoji": "üå±"
    },
    "seed_discount": {
        "name": "üí∞ Gi·∫£m Gi√° H·∫°t Gi·ªëng", 
        "description": "Gi·∫£m gi√° mua h·∫°t gi·ªëng",
        "emoji": "üí∞"
    },
    "yield_boost": {
        "name": "üìà TƒÉng S·∫£n L∆∞·ª£ng",
        "description": "TƒÉng s·ªë l∆∞·ª£ng n√¥ng s·∫£n thu ho·∫°ch",
        "emoji": "üìà"
    },
    "sell_price": {
        "name": "üíé TƒÉng Gi√° B√°n",
        "description": "TƒÉng gi√° b√°n n√¥ng s·∫£n",
        "emoji": "üíé"
    }
}

# Sample Maid Data
MAID_TEMPLATES = {
    # UR Maids (6 maids - 2 buffs each)
    "rem_ur": {
        "name": "Rem",
        "full_name": "Rem the Devoted Maid",
        "rarity": "UR", 
        "description": "C√¥ h·∫ßu g√°i t·∫≠n t√¢m v·ªõi s·ª©c m·∫°nh oni v√† t√¨nh y√™u b·∫•t di·ªát",
        "emoji": "üíô",
        "possible_buffs": ["yield_boost", "sell_price", "growth_speed"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1387927655201902732/Rem.jpg?ex=685f1fdb&is=685dce5b&hm=5d9f9d72ffb6288db68c4c02595ac20c275913d5daf15508cbc9a21f54e7e3aa&=&format=webp&width=570&height=856",  # Placeholder - replace with actual
        "series": "Re:Zero"
    },
    "saber_ur": {
        "name": "Saber",
        "full_name": "Artoria Pendragon the King of Knights",
        "rarity": "UR",
        "description": "Vua c·ªßa c√°c hi·ªáp sƒ© v·ªõi thanh ki·∫øm thi√™ng li√™ng Excalibur",
        "emoji": "‚öîÔ∏è",
        "possible_buffs": ["growth_speed", "yield_boost", "sell_price"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1387927656179302542/Saber_Artoria.jpg?ex=685f1fdb&is=685dce5b&hm=f8244bbca19a19c8da6704978c08ca667b66c4bb5ad88908a8bae8e2c6343712&=&format=webp&width=592&height=856",  # Replace with actual Saber image
        "series": "Fate/Stay Night"
    },
    "rias_ur": {
        "name": "Rias",
        "full_name": "Rias Gremory the Devil Princess",
        "rarity": "UR",
        "description": "C√¥ng ch√∫a qu·ª∑ v·ªõi s·ª©c m·∫°nh h·ªßy di·ªát v√† tr√°i tim nh√¢n h·∫≠u",
        "emoji": "üëπ",
        "possible_buffs": ["sell_price", "seed_discount", "yield_boost"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1387927655843627128/Rias_Gremory.jpg?ex=685f1fdb&is=685dce5b&hm=4822615d7728d1fa765f8272d1a4e0b6166991c96d93e73324c2ccb282accaac&=&format=webp&width=650&height=856"
    },
    "emilia_ur": {
        "name": "Emilia",
        "full_name": "Emilia the Half-Elf Princess",
        "rarity": "UR",
        "description": "C√¥ng ch√∫a b√°n elf v·ªõi ma thu·∫≠t bƒÉng v√† tr√°i tim trong s√°ng",
        "emoji": "‚ùÑÔ∏è",
        "possible_buffs": ["growth_speed", "seed_discount", "yield_boost"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1387927653926965310/Emilia.jpg?ex=685f1fdb&is=685dce5b&hm=a96f2881766ae4d8fbb125559c1f6b8f6351108044c231053d530eafd8c9ea0d&=&format=webp&width=586&height=855"
    },
    "yoshino_ur": {
        "name": "Yoshino",
        "full_name": "Yoshino the Gentle Spirit",
        "rarity": "UR",
        "description": "Linh h·ªìn hi·ªÅn l√†nh v·ªõi s·ª©c m·∫°nh bƒÉng gi√° v√† con th·ªè Yoshinon",
        "emoji": "üê∞",
        "possible_buffs": ["growth_speed", "yield_boost", "seed_discount"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1387927656594542652/Yoshino.jpg?ex=685f1fdb&is=685dce5b&hm=0efe8cc3a6c503e70c2fd24ecdfe33f12c57f54427ebba9b48a7b6315f423da1&=&format=webp&width=570&height=856"
    },
    "kurumi_ur": {
        "name": "Kurumi",
        "full_name": "Kurumi Tokisaki the Nightmare",
        "rarity": "UR",
        "description": "Linh h·ªìn th·ªùi gian v·ªõi kh·∫£ nƒÉng thao t√∫ng th·ªùi gian tuy·ªát ƒë·ªëi",
        "emoji": "üï∞Ô∏è",
        "possible_buffs": ["growth_speed", "sell_price", "yield_boost"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1387927654522687599/Kurumi_Tokisaki.jpg?ex=685f1fdb&is=685dce5b&hm=d885172efab97e155ed641648cba3e73f2dab8546de6a8ba98910c3d5bec0edc&=&format=webp&width=602&height=855",
        "series": "Date A Live"
    },
    "jalter_gr": {
        "name": "Jeanne d'Arc Alter",
        "full_name": "Jeanne d'Arc Alter the Dragon Witch",
        "rarity": "GR",
        "description": "Phi√™n b·∫£n t√† √°c c·ªßa th√°nh n·ªØ Orleans v·ªõi quy·ªÅn nƒÉng r·ªìng v√† l·ª≠a ƒë·ªãa ng·ª•c - GHOST RARE",
        "emoji": "üî•",
        "possible_buffs": ["sell_price", "yield_boost", "growth_speed"],  # 3 buffs for GR
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1387683466820452415/Jeanne_dArc_Alter.jpg?ex=685ee530&is=685d93b0&hm=5cf04653e003b4e7ca5cf75b4e545cc5e92cd023b7fee3adef43d6886c569c9d&=&format=webp",
        "series": "Fate/Grand Order",
        "limited_only": True,  # üåü LIMITED BANNER ONLY
        "banner_featured": False  # Kh√¥ng featured m·∫∑c ƒë·ªãnh
    },
    "kotori_gr": {
        "name": "Kotori",
        "full_name": "Kotori Itsuka the Spirit Sister",
        "rarity": "GR",
        "description": "C√¥ em g√°i ƒë√°ng y√™u v·ªõi quy·ªÅn nƒÉng c·ªßa Ifrit - GHOST RARE",
        "emoji": "üç°",
        "possible_buffs": ["growth_speed", "yield_boost", "sell_price"],  # 3 buffs for GR
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1387683467172646933/Kotori_itsuka.jpg?ex=685e3c70&is=685ceaf0&hm=59f11fcec933090af2d036675c33e6538e35d6cbcca8b908c444ba0f4beb047c&=&format=webp&width=600&height=855",
        "series": "Date A Live",
        "limited_only": True,  # üåü LIMITED BANNER ONLY
        "banner_featured": True  # Featured m·∫∑c ƒë·ªãnh cho Kotori
    },

    # SSR Maids (10 maids - 1 buff each)
    "mikasa_ssr": {
        "name": "Mikasa",
        "full_name": "Mikasa Ackerman the Strongest Soldier",
        "rarity": "SSR",
        "description": "Chi·∫øn binh m·∫°nh nh·∫•t nh√¢n lo·∫°i v·ªõi t·ªëc ƒë·ªô v√† s·ª©c m·∫°nh kinh ho√†ng",
        "emoji": "‚ö°",
        "possible_buffs": ["growth_speed"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870505033961602/Mikasa_Ackerman.jpg?ex=685b474f&is=6859f5cf&hm=5a8e69c2c5117d05e1c91ae44fecee4674fb7b8e0012468e35509cd08532684e&=&format=webp&width=481&height=856"
    },
    "asuna_ssr": {
        "name": "Asuna",
        "full_name": "Asuna Yuuki the Lightning Flash",
        "rarity": "SSR",
        "description": "Tia ch·ªõp c·ªßa SAO v·ªõi k·ªπ nƒÉng ƒë·∫•u ki·∫øm tuy·ªát v·ªùi",
        "emoji": "üí´",
        "possible_buffs": ["growth_speed"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870453884158023/Asuna_Yuuki.jpg?ex=685b4743&is=6859f5c3&hm=c39ab7d30ad414bc142d37a3c6adaa8c357baafcaced5f02fcef343bb4364680&=&format=webp&width=685&height=856"
    },
    "zero_two_ssr": {
        "name": "Zero Two",
        "full_name": "Zero Two the Darling in the FranXX",
        "rarity": "SSR",
        "description": "C√¥ g√°i lai oni v·ªõi ƒë√¥i s·ª´ng ƒë√°ng y√™u v√† t√≠nh c√°ch n·ªïi lo·∫°n",
        "emoji": "ü¶ã",
        "possible_buffs": ["yield_boost"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870685028188272/Zero_Two.jpg?ex=685b477a&is=6859f5fa&hm=4a48df6f3048964db7a68ca1784a6da0516920f048ca5908456f8aaf9dcbf3d3&=&format=webp&width=510&height=856"
    },
    "violet_ssr": {
        "name": "Violet",
        "full_name": "Violet Evergarden the Auto Memory Doll",
        "rarity": "SSR",
        "description": "B√∫p b√™ k√Ω ·ª©c t·ª± ƒë·ªông v·ªõi kh·∫£ nƒÉng vi·∫øt th∆∞ tuy·ªát v·ªùi",
        "emoji": "üìù",
        "possible_buffs": ["sell_price"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870682943492097/Violet_Evergarden.webp?ex=685b4779&is=6859f5f9&hm=8437d50d2c31a39f59ebcb18a5420ae2e1fd4a7b8eaddaf161c137f0fd98a460&=&format=webp&width=662&height=856"
    },
    "kurisu_ssr": {
        "name": "Kurisu",
        "full_name": "Kurisu Makise the Genius Scientist",
        "rarity": "SSR",
        "description": "Nh√† khoa h·ªçc thi√™n t√†i chuy√™n v·ªÅ th·ªùi gian du h√†nh",
        "emoji": "üß™",
        "possible_buffs": ["seed_discount"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870502621970523/Kurisu_Makise.jpg?ex=685b474e&is=6859f5ce&hm=b3e950cae954510ab16df8e0377c8275441e8f7607a5c99afa2261181d16fce2&=&format=webp&width=685&height=856"
    },
    "makima_ssr": {
        "name": "Makima",
        "full_name": "Makima the Control Devil",
        "rarity": "SSR",
        "description": "Qu·ª∑ ki·ªÉm so√°t v·ªõi s·ª©c m·∫°nh thao t√∫ng tuy·ªát ƒë·ªëi",
        "emoji": "üëÅÔ∏è",
        "possible_buffs": ["sell_price"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870504115277864/Makima.webp?ex=685b474e&is=6859f5ce&hm=202b238fe62b8c9a152e1d05a424074e11143ecb3baf90168101e451b221662b&=&format=webp&width=482&height=856"
    },
    "yor_ssr": {
        "name": "Yor",
        "full_name": "Yor Forger the Thorn Princess",
        "rarity": "SSR",
        "description": "C√¥ng ch√∫a gai v·ªõi k·ªπ nƒÉng √°m s√°t ƒë·ªânh cao",
        "emoji": "üåπ",
        "possible_buffs": ["growth_speed"],
        "art_url": "https://media.discordapp.net/attachments/1294342075541753936/1387128548661268672/Yor_Forger.jpg?ex=685c37a1&is=685ae621&hm=21bf3ee1df7401b13cbc0763754055d4ee00e5a8c6375d73dcbabbad9b5b75a6&=&format=webp&width=734&height=960"
    },
    "kaguya_ssr": {
        "name": "Kaguya",
        "full_name": "Kaguya Shinomiya the Ice Princess",
        "rarity": "SSR",
        "description": "C√¥ng ch√∫a bƒÉng gi√° v·ªõi tr√≠ tu·ªá v√† ki√™u h√£nh tuy·ªát ƒë·ªëi",
        "emoji": "üè∞",
        "possible_buffs": ["seed_discount"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870502274109582/Kaguya_Shinomiya.jpg?ex=685b474e&is=6859f5ce&hm=0ca3c68c511d38cb53030004d5318642f1f863323c8ef6d1d2d942c97bf09503&=&format=webp&width=584&height=856"
    },
    "tatsumaki_ssr": {
        "name": "Tatsumaki",
        "full_name": "Tatsumaki the Tornado of Terror",
        "rarity": "SSR",
        "description": "Si√™u anh h√πng esper v·ªõi s·ª©c m·∫°nh t√¢m linh kh·ªßng khi·∫øp",
        "emoji": "üå™Ô∏è",
        "possible_buffs": ["yield_boost"],
        "art_url": "https://media.discordapp.net/attachments/1294342075541753936/1387122701797294272/Tatsumaki.jpg?ex=685c322f&is=685ae0af&hm=7c9a35f9348c5b2ed0b2eb4e64ea458cdfbdcf248fff8d38b6e89726219ac8b2&=&format=webp&width=657&height=960"
    },
    "megumin_ssr": {
        "name": "Megumin",
        "full_name": "Megumin the Explosion Wizard",
        "rarity": "SSR",
        "description": "Ph√π th·ªßy n·ªï chuy√™n v·ªÅ ma ph√°p explosion duy nh·∫•t",
        "emoji": "üí•",
        "possible_buffs": ["yield_boost"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870504681504881/Megumin.jpeg?ex=685b474f&is=6859f5cf&hm=348c79d84a58eaeedf3f5bdde555ece71262e394244e36f9dde123aa30c55811&=&format=webp&width=619&height=856"
    },

    # SR Maids (15 maids - 1 buff each)
    "usagi_sr": {
        "name": "Usagi",
        "full_name": "Usagi Tsukino Sailor Moon",
        "rarity": "SR",
        "description": "Chi·∫øn binh Sailor Moon b·∫£o v·ªá t√¨nh y√™u v√† c√¥ng l√Ω",
        "emoji": "üåô",
        "possible_buffs": ["growth_speed"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870682356547685/Usagi_Tsukino.jpg?ex=685b4779&is=6859f5f9&hm=25a41ab796cfbe6286f405b06d7834ca3c9ccbdd66072895cc5c5c18c51cb5ae&=&format=webp&width=605&height=855"
    },
    "hinata_sr": {
        "name": "Hinata",
        "full_name": "Hinata Hyuga the Byakugan Princess",
        "rarity": "SR",
        "description": "C√¥ng ch√∫a Byakugan v·ªõi t√≠nh c√°ch nh√∫t nh√°t nh∆∞ng m·∫°nh m·∫Ω",
        "emoji": "üëÅÔ∏è‚Äçüó®Ô∏è",
        "possible_buffs": ["seed_discount"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386872902799986869/Hinata_Hyuga.webp?ex=685b498a&is=6859f80a&hm=b2cc07a5c27d2355b240a9cdf4a7fab9a5d91c3d14f23b1c35bdc9f097ffdefb&=&format=webp"
    },
    "nezuko_sr": {
        "name": "Nezuko",
        "full_name": "Nezuko Kamado the Demon Sister",
        "rarity": "SR",
        "description": "C√¥ em g√°i qu·ª∑ v·ªõi kh·∫£ nƒÉng thu nh·ªè v√† t√¨nh y√™u th∆∞∆°ng",
        "emoji": "üéã",
        "possible_buffs": ["yield_boost"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870549367492688/Nezuko_Kamado.jpg?ex=685b4759&is=6859f5d9&hm=ef93fa83e226f4f5aa7e643b21361e994b865fc66df40ed4dc8660fb609c09f4&=&format=webp&width=606&height=856"
    },
    "mai_sr": {
        "name": "Mai",
        "full_name": "Sakurajima Mai the Bunny Girl Senpai",
        "rarity": "SR",
        "description": "N·ªØ di·ªÖn vi√™n n·ªïi ti·∫øng v·ªõi hi·ªán t∆∞·ª£ng kh√¥ng gian l·∫°",
        "emoji": "üê∞",
        "possible_buffs": ["sell_price"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870609094381588/Sakurajima_Mai.webp?ex=685b4768&is=6859f5e8&hm=0d5e2162bd282df358fee1d80603f90b3d4ad9f2fed17ce5cc8bb8701ed0ff3d&=&format=webp&width=481&height=856"
    },
    "hitagi_sr": {
        "name": "Hitagi",
        "full_name": "Hitagi Senjougahara the Tsundere Queen",
        "rarity": "SR",
        "description": "N·ªØ ho√†ng tsundere v·ªõi l·ªùi n√≥i s·∫Øc b√©n nh∆∞ dao",
        "emoji": "‚úÇÔ∏è",
        "possible_buffs": ["sell_price"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870455855485140/Hitagi_Senjougahara.jpg?ex=685b4743&is=6859f5c3&hm=ffe10fd2acc286b2e8aca8a6b63839d56b4fafb297d2dc3a2636225a7efc1405&=&format=webp&width=634&height=856"
    },
    "erza_sr": {
        "name": "Erza",
        "full_name": "Erza Scarlet the Titania",
        "rarity": "SR",
        "description": "N·ªØ ho√†ng ti√™n n·ªØ v·ªõi ma ph√°p thay ƒë·ªïi √°o gi√°p",
        "emoji": "üõ°Ô∏è",
        "possible_buffs": ["growth_speed"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870455192784986/Erza_Scarlet.jpg?ex=685b4743&is=6859f5c3&hm=1b477aef71d431f6e2a986bea06fb0bb5492617eef09385956420cb54d3d9da6&=&format=webp&width=481&height=856"
    },
    "nami_sr": {
        "name": "Nami",
        "full_name": "Nami the Cat Burglar Navigator",
        "rarity": "SR",
        "description": "H√†ng h·∫£i c·ªßa bƒÉng M≈© R∆°m v·ªõi t√†i nƒÉng ƒë·ªãnh h∆∞·ªõng",
        "emoji": "üó∫Ô∏è",
        "possible_buffs": ["seed_discount"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870548860113018/Nami.jpg?ex=685b4759&is=6859f5d9&hm=23b0595536171a4d897a867ad98142d4675c15f720ff61f57841b08c3d02969f&=&format=webp"
    },
    "robin_sr": {
        "name": "Robin",
        "full_name": "Nico Robin the Devil Child",
        "rarity": "SR",
        "description": "Kh·∫£o c·ªï h·ªçc gia v·ªõi tr√°i √°c qu·ª∑ Hana Hana",
        "emoji": "üå∏",
        "possible_buffs": ["yield_boost"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870549619281950/Nico_Robin.jpg?ex=685b4759&is=6859f5d9&hm=3db0a455064b73f280c5e1511524bb8b5e727c569454d15ac721c9f81e53c643&=&format=webp"
    },
    "komi_sr": {
        "name": "Komi",
        "full_name": "Shoko Komi the Communication Goddess",
        "rarity": "SR",
        "description": "N·ªØ th·∫ßn giao ti·∫øp v·ªõi v·∫ª ƒë·∫πp tuy·ªát tr·∫ßn nh∆∞ng s·ª£ n√≥i chuy·ªán",
        "emoji": "üì±",
        "possible_buffs": ["sell_price"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870610214387813/Shoko_Komi.webp?ex=685b4768&is=6859f5e8&hm=7d1d718809933bcac2cd6f0be2e997967682e2ef294e060c4c9822d7b40341be&=&format=webp&width=577&height=856"
    },
    "chihiro_sr": {
        "name": "Chihiro",
        "full_name": "Chihiro Ogino the Spirited Girl",
        "rarity": "SR",
        "description": "C√¥ b√© d≈©ng c·∫£m trong th·∫ø gi·ªõi th·∫ßn linh",
        "emoji": "üê≤",
        "possible_buffs": ["growth_speed"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870454349730003/Chihiro_Ogino.jpg?ex=685b4743&is=6859f5c3&hm=3441b4bef47ae1b4bfe8917091fe3bb52323d34a0a40404fb292434394b15c04&=&format=webp&width=602&height=855"
    },
    "rei_sr": {
        "name": "Rei",
        "full_name": "Rei Ayanami the First Child",
        "rarity": "SR",
        "description": "Pilot Eva ƒë·∫ßu ti√™n v·ªõi t√≠nh c√°ch l·∫°nh l√πng b√≠ ·∫©n",
        "emoji": "ü§ñ",
        "possible_buffs": ["seed_discount"],
        "art_url": "https://media.discordapp.net/attachments/1294342075541753936/1387125073885921301/76ac0aa7aea76205fcaece3a021ca457.jpg?ex=685c3465&is=685ae2e5&hm=3a9e235e27803124f5419579a950417e5f5432ce0198a4034a1091be88fa5747&=&format=webp&width=591&height=960"
    },
    "asuka_sr": {
        "name": "Asuka",
        "full_name": "Asuka Langley Soryu the Second Child",
        "rarity": "SR",
        "description": "Pilot Eva th·ª© hai v·ªõi t√≠nh c√°ch m·∫°nh m·∫Ω v√† ki√™u h√£nh",
        "emoji": "üî•",
        "possible_buffs": ["yield_boost"],
        "art_url": "https://media.discordapp.net/attachments/1294342075541753936/1387127701969834135/Asuka_Langley_.jpg?ex=685c36d7&is=685ae557&hm=88449a725a0e7c3e30faa791c3816927a62fb52b009994aef711f71f632d8940&=&format=webp&width=677&height=960"
    },
    "shinobu_sr": {
        "name": "Shinobu",
        "full_name": "Shinobu Kocho the Insect Hashira",
        "rarity": "SR",
        "description": "Tr·ª• c√¥n tr√πng v·ªõi n·ª• c∆∞·ªùi d·ªãu d√†ng v√† ƒë·ªôc t√≠nh ch·∫øt ng∆∞·ªùi",
        "emoji": "ü¶ã",
        "possible_buffs": ["sell_price"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870609895493753/Shinobu_Kocho.jpg?ex=685b4768&is=6859f5e8&hm=42cf5c066caab7ffd9ba5e77a5f6fef630641b3edefe9eb52a714868dc95e5fc&=&format=webp&width=583&height=856"
    },
    "mitsuri_sr": {
        "name": "Mitsuri",
        "full_name": "Mitsuri Kanroji the Love Hashira",
        "rarity": "SR",
        "description": "Tr·ª• t√¨nh y√™u v·ªõi s·ª©c m·∫°nh kh·ªïng l·ªì v√† tr√°i tim nh√¢n h·∫≠u",
        "emoji": "üíó",
        "possible_buffs": ["yield_boost"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870547979436042/Mitsuri_Kanroji.webp?ex=685b4759&is=6859f5d9&hm=4dc66db2477b2644cdadf1337ddddacda9f21ce336be516d652752a598eaa8f2&=&format=webp&width=478&height=856"
    },
    "power_sr": {
        "name": "Power",
        "full_name": "Power the Blood Devil",
        "rarity": "SR",
        "description": "Qu·ª∑ m√°u v·ªõi t√≠nh c√°ch √≠ch k·ª∑ nh∆∞ng ƒë√°ng y√™u",
        "emoji": "ü©∏",
        "possible_buffs": ["growth_speed"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870550357475399/Power.jpg?ex=685b475a&is=6859f5da&hm=5ec3c3712b0bcee58ecf33a1fdf8e8a7cee6214829aeb17a26782e6a562d1c87&=&format=webp&width=605&height=856"
    },

    # R Maids (19 maids - 1 buff each)
    "android18_r": {
        "name": "Android 18",
        "full_name": "Android 18 the Infinite Energy",
        "rarity": "R",
        "description": "Cyborg v·ªõi nƒÉng l∆∞·ª£ng v√¥ h·∫°n v√† s·ª©c m·∫°nh kh·ªßng khi·∫øp",
        "emoji": "ü§ñ",
        "possible_buffs": ["growth_speed"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870453204947004/Android_18.jpg?ex=685b4742&is=6859f5c2&hm=4094cb5e34a9e87d4fdc424486c2bcd52b4c6867147e2f339957a5985412e466&=&format=webp&width=605&height=856"
    },
    "rukia_r": {
        "name": "Rukia",
        "full_name": "Rukia Kuchiki the Soul Reaper",
        "rarity": "R",
        "description": "Th·∫ßn ch·∫øt v·ªõi Zanpakuto bƒÉng tuy·∫øt Sode no Shirayuki",
        "emoji": "‚ùÑÔ∏è",
        "possible_buffs": ["seed_discount"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870608045805649/Rukia_Kuchiki.webp?ex=685b4767&is=6859f5e7&hm=032641179dc877d83c01003137799b15dbd042ed7e190d643bb0c3f183eb21eb&=&format=webp&width=685&height=856"
    },
    "venus_r": {
        "name": "Venus",
        "full_name": "Sailor Venus the Guardian of Love",
        "rarity": "R",
        "description": "Chi·∫øn binh Sailor Venus b·∫£o v·ªá t√¨nh y√™u v√† v·∫ª ƒë·∫πp",
        "emoji": "üíõ",
        "possible_buffs": ["yield_boost"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870608729739455/Sailor_Venus.avif?ex=685b4767&is=6859f5e7&hm=08ce4a8269845288fb564d777e483a428330423dfd1c495f76c18e5929d548e4&=&format=webp&quality=lossless"
    },
    "tohru_r": {
        "name": "Tohru",
        "full_name": "Tohru Honda the Kind Heart",
        "rarity": "R",
        "description": "C√¥ g√°i v·ªõi tr√°i tim nh√¢n h·∫≠u v√† kh·∫£ nƒÉng ch·ªØa l√†nh",
        "emoji": "üåª",
        "possible_buffs": ["sell_price"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870681827807262/Tohru_Honda.jpg?ex=685b4779&is=6859f5f9&hm=166f88be6af4efb151531a6657334eadbf75a9de2c50619d1fd921ae935b09d4&=&format=webp"
    },
    "kagome_r": {
        "name": "Kagome",
        "full_name": "Kagome Higurashi the Time Traveler",
        "rarity": "R",
        "description": "N·ªØ sinh du h√†nh th·ªùi gian v·ªõi m≈©i t√™n thi√™ng li√™ng",
        "emoji": "üèπ",
        "possible_buffs": ["growth_speed"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870501317677086/Kagome_Higurashi.webp?ex=685b474e&is=6859f5ce&hm=fae8ac9c853aa536bbf3e91c1bab7d959d919c016034230fcac7fd5dfa555ab8&=&format=webp"
    },
    "yuno_r": {
        "name": "Yuno",
        "full_name": "Yuno Gasai the Yandere Queen",
        "rarity": "R",
        "description": "N·ªØ ho√†ng yandere v·ªõi t√¨nh y√™u √°m ·∫£nh v√† dao gƒÉm",
        "emoji": "üî™",
        "possible_buffs": ["sell_price"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870684743106630/Yuno_Gasai.jpg?ex=685b477a&is=6859f5fa&hm=e15cd883fa7b1d855d4277d390ed103343492655700c832a1c3bf414fa4db8c7&=&format=webp&width=481&height=856"
    },
    "holo_r": {
        "name": "Holo",
        "full_name": "Holo the Wise Wolf",
        "rarity": "R",
        "description": "S√≥i th√¥ng th√°i c·ªßa thu ho·∫°ch v·ªõi ki·∫øn th·ª©c kinh t·∫ø",
        "emoji": "üê∫",
        "possible_buffs": ["seed_discount"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1387124618124333157/Holo.jpg?ex=685c33f8&is=685ae278&hm=7f82d0712d57b8122912a7ccba0e9e142fddba1db0496b626e3b8f6ea7599fef&=&format=webp&width=576&height=960"
    },
    "vivi_r": {
        "name": "Vivi",
        "full_name": "Nefertari Vivi the Desert Princess",
        "rarity": "R",
        "description": "C√¥ng ch√∫a sa m·∫°c v·ªõi tr√°i tim v√¨ d√¢n t·ªôc",
        "emoji": "üèúÔ∏è",
        "possible_buffs": ["yield_boost"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870549128675348/Nefertari_Vivi.jpg?ex=685b4759&is=6859f5d9&hm=45175bee6f4c94a76f92be3515238e908c0417aa8b645d12e1f96a4610f168ed&=&format=webp&width=642&height=856"
    },
    "revy_r": {
        "name": "Revy",
        "full_name": "Revy the Two Hand",
        "rarity": "R",
        "description": "Tay s√∫ng l·ª´ng danh v·ªõi ƒë√¥i s√∫ng l·ª•c Beretta",
        "emoji": "üî´",
        "possible_buffs": ["growth_speed"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870607160938576/Revy.webp?ex=685b4767&is=6859f5e7&hm=91d95db1b81aa369ca2cc2c54132d215bc3966b138c30080b8ba8da63af44ccc&=&format=webp"
    },
    "jolyne_r": {
        "name": "Jolyne",
        "full_name": "Jolyne Cujoh the Stone Free",
        "rarity": "R",
        "description": "Con g√°i c·ªßa Jotaro v·ªõi Stand Stone Free",
        "emoji": "üï∑Ô∏è",
        "possible_buffs": ["sell_price"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870456388157470/Jolyne_Cujoh.jpg?ex=685b4743&is=6859f5c3&hm=1d5ef9bd0cd198e03460de93873f1c7b840fc41ba66db5afd25f5ece4a4c8e46&=&format=webp"
    },
    "nobara_r": {
        "name": "Nobara",
        "full_name": "Nobara Kugisaki the Straw Doll",
        "rarity": "R",
        "description": "Ph√π th·ªßy b√∫p b√™ r∆°m v·ªõi b√∫a v√† ƒëinh th√©p",
        "emoji": "üî®",
        "possible_buffs": ["yield_boost"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870549904621661/Nobara_Kugisaki.jpg?ex=685b4759&is=6859f5d9&hm=48b705bda7a7fe6da8aa6cad09703d2b8332df5de5b1ba4969f1464dc482b4b6&=&format=webp&width=605&height=856"
    },
    "mio_r": {
        "name": "Mio",
        "full_name": "Mio Akiyama the Bass Guitarist",
        "rarity": "R",
        "description": "Tay bass shycore v·ªõi m√°i t√≥c ƒëen d√†i",
        "emoji": "üé∏",
        "possible_buffs": ["seed_discount"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870505306325062/Mio_Akiyama.jpg?ex=685b474f&is=6859f5cf&hm=9b357f58ccde0040cc101aabcd1f7f06007e5746233823dceb6cf143362e4d75&=&format=webp&width=481&height=855"
    },
    "sheryl_r": {
        "name": "Sheryl",
        "full_name": "Sheryl Nome the Galactic Fairy",
        "rarity": "R",
        "description": "N√†ng ti√™n thi√™n h√† v·ªõi gi·ªçng h√°t m√™ ho·∫∑c",
        "emoji": "üé§",
        "possible_buffs": ["sell_price"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870609392304180/Sheryl_Nome.webp?ex=685b4768&is=6859f5e8&hm=e8028f09c1e9007fe359f2139ad3de85d3e6322d5ac35a6ca00512ce988a134b&=&format=webp"
    },
    "lina_r": {
        "name": "Lina",
        "full_name": "Lina Inverse the Dragon Spooker",
        "rarity": "R",
        "description": "Ph√π th·ªßy h·ªßy di·ªát v·ªõi Dragon Slave tuy·ªát ƒë·ªânh",
        "emoji": "üê≤",
        "possible_buffs": ["growth_speed"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870503813283991/Lina_Inverse.jpg?ex=685b474e&is=6859f5ce&hm=f50892be26b9295caaac0561b50a2fe855f6d72ed9de53aa86e041c63f033d44&=&format=webp&width=564&height=856"
    },
    "kagura_r": {
        "name": "Kagura",
        "full_name": "Kagura shikigami",
        "rarity": "R",
        "description": "Shikigami xinh x·∫Øn, ƒë√°ng y√™u",
        "emoji": "‚òÇÔ∏è",
        "possible_buffs": ["yield_boost"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870501976047626/Kagura.png?ex=685b474e&is=6859f5ce&hm=3f2995224caa79ff0a22270bf6f895620db13e8e39a7d94176203637a381f196&=&format=webp&quality=lossless"
    },
    "motoko_r": {
        "name": "Motoko",
        "full_name": "Motoko Kusanagi the Major",
        "rarity": "R",
        "description": "Thi·∫øu t√° cyborg trong th·∫ø gi·ªõi c√¥ng ngh·ªá cao",
        "emoji": "üî¨",
        "possible_buffs": ["seed_discount"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870548629295135/Motoko_Kusanagi.jpg?ex=685b4759&is=6859f5d9&hm=4f1c780232bf0cb2356891eefe5560d20c813b9a1f9af49b99be32496d81db60&=&format=webp&width=590&height=856"
    },
    "yoruichi_r": {
        "name": "Yoruichi",
        "full_name": "Yoruichi Shihouin the Flash Goddess",
        "rarity": "R",
        "description": "N·ªØ th·∫ßn t·ªëc ƒë·ªô v·ªõi kh·∫£ nƒÉng bi·∫øn h√¨nh m√®o",
        "emoji": "üê±",
        "possible_buffs": ["growth_speed"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870683908313088/Yoruichi_Shihouin.jpeg?ex=685b4779&is=6859f5f9&hm=4db365b6bbca1db03794b6da709af9d9a272554195f10c56e21540a82dfa15f6&=&format=webp&width=595&height=855"
    },
    "esdeath_r": {
        "name": "Esdeath",
        "full_name": "Esdeath the Ice Queen General",
        "rarity": "R",
        "description": "N·ªØ t∆∞·ªõng bƒÉng gi√° v·ªõi s·ª©c m·∫°nh tuy·ªát ƒë·ªëi",
        "emoji": "üßä",
        "possible_buffs": ["sell_price"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1387124577724797011/Esdeath.jpg?ex=685c33ee&is=685ae26e&hm=7703de348911c92ae0bd67087e02000d1d8c887afaeedf79e2d2e7ffe69f8781&=&format=webp&width=657&height=960"
    },
    "tsunade_r": {
        "name": "Tsunade",
        "full_name": "Tsunade Senju the Legendary Sannin",
        "rarity": "R",
        "description": "M·ªôt trong ba Sannin huy·ªÅn tho·∫°i v·ªõi s·ª©c m·∫°nh kh·ªßng khi·∫øp",
        "emoji": "üëë",
        "possible_buffs": ["yield_boost"],
        "art_url": "https://media.discordapp.net/attachments/1173415199043239947/1386870682037518416/Tsunade_Senju.jpg?ex=685b4779&is=6859f5f9&hm=30867deac805b7eb23d318c1282a960de9fdbd7a89f79dd1543b27bc7f35d85e&=&format=webp"
    }
}

def get_random_maid_by_individual_rates() -> str:
    """
    üéØ NEW: Roll m·ªôt maid c·ª• th·ªÉ d·ª±a tr√™n individual rates
    M·ªói maid c√≥ rate ri√™ng = total_rate / maid_count c·ªßa rarity ƒë√≥
    
    Returns:
        maid_id c·ªßa maid ƒë∆∞·ª£c roll
    """
    # T·∫°o weighted list c·ªßa t·∫•t c·∫£ maids
    weighted_maids = []
    
    for maid_id, template in MAID_TEMPLATES.items():
        rarity = template["rarity"]
        individual_rate = RARITY_CONFIG[rarity]["individual_rate"]
        
        # Th√™m v√†o list v·ªõi weight = individual_rate (chuy·ªÉn % th√†nh decimal)
        weighted_maids.append((maid_id, individual_rate))
    
    # T√≠nh total weight
    total_weight = sum(weight for _, weight in weighted_maids)
    
    # Random selection
    rand = random.random() * total_weight
    current_weight = 0
    
    for maid_id, weight in weighted_maids:
        current_weight += weight
        if rand <= current_weight:
            return maid_id
    
    # Fallback - return random R maid n·∫øu c√≥ l·ªói
    r_maids = [maid_id for maid_id, template in MAID_TEMPLATES.items() 
               if template["rarity"] == "R"]
    return random.choice(r_maids) if r_maids else "tsunade_r"

def get_all_maid_rates() -> Dict[str, float]:
    """
    üìä L·∫•y t·∫•t c·∫£ individual rates c·ªßa t·ª´ng maid
    
    Returns:
        Dict v·ªõi key = maid_id, value = individual_rate
    """
    rates = {}
    for maid_id, template in MAID_TEMPLATES.items():
        rarity = template["rarity"]
        individual_rate = RARITY_CONFIG[rarity]["individual_rate"]
        rates[maid_id] = individual_rate
    
    return rates

def get_rarity_by_rate() -> str:
    """üîÑ LEGACY: Random rarity d·ª±a theo total rates (for backwards compatibility)"""
    rand = random.uniform(0, 100)
    
    if rand <= RARITY_CONFIG["UR"]["total_rate"]:
        return "UR"
    elif rand <= RARITY_CONFIG["UR"]["total_rate"] + RARITY_CONFIG["SSR"]["total_rate"]:
        return "SSR"
    elif rand <= (RARITY_CONFIG["UR"]["total_rate"] + 
                  RARITY_CONFIG["SSR"]["total_rate"] + 
                  RARITY_CONFIG["SR"]["total_rate"]):
        return "SR"
    else:
        return "R"

def get_maids_by_rarity(rarity: str) -> List[str]:
    """üîÑ LEGACY: L·∫•y danh s√°ch maid_id theo rarity"""
    return [maid_id for maid_id, data in MAID_TEMPLATES.items() 
            if data["rarity"] == rarity]

def generate_random_buffs(maid_id: str) -> List[Dict[str, Any]]:
    """Generate random buffs cho maid v·ªõi validation"""
    template = MAID_TEMPLATES[maid_id]
    rarity = template["rarity"]
    rarity_config = RARITY_CONFIG[rarity]
    
    # S·ªë l∆∞·ª£ng buff
    buff_count = rarity_config["buff_count"]
    
    # Ch·ªçn random buff types
    available_buffs = template["possible_buffs"]
    selected_buffs = random.sample(available_buffs, min(buff_count, len(available_buffs)))
    
    # üõ°Ô∏è Buff caps per type ƒë·ªÉ tr√°nh overpowered
    BUFF_CAPS = {
        "growth_speed": 80.0,      # Max 80% faster growth
        "seed_discount": 90.0,     # Max 90% discount
        "yield_boost": 200.0,      # Max 200% more yield
        "sell_price": 150.0        # Max 150% sell price
    }
    
    # Generate random values
    buffs = []
    for buff_type in selected_buffs:
        min_val, max_val = rarity_config["buff_range"]
        
        # üõ°Ô∏è Apply caps
        if buff_type in BUFF_CAPS:
            max_val = min(max_val, BUFF_CAPS[buff_type])
        
        value = round(random.uniform(min_val, max_val), 1)
        
        # üõ°Ô∏è Ensure positive values
        value = max(0.1, value)
        
        buffs.append({
            "buff_type": buff_type,
            "value": value,
            "description": f"{BUFF_TYPES[buff_type]['name']}: +{value}%"
        })
    
    return buffs

# UI Configuration
UI_CONFIG = {
    "maids_per_page": 6,        # S·ªë maid hi·ªÉn th·ªã m·ªói page
    "trades_per_page": 5,       # S·ªë trade hi·ªÉn th·ªã m·ªói page
    "history_per_page": 10,     # S·ªë l·ªãch s·ª≠ hi·ªÉn th·ªã m·ªói page
}

# Legacy Maid ID Mapping (for backwards compatibility)
LEGACY_MAID_MAPPING = {
    "jalter_ur": "jalter_gr",  # Old Jalter UR ‚Üí New Jalter GR
    # Add more legacy mappings as needed
}

# Emoji cho rarity
RARITY_EMOJIS = {
    "GR": "üëª",    # Ghost emoji cho Ghost Rare
    "UR": "üíé",
    "SSR": "üåü", 
    "SR": "‚≠ê",
    "R": "‚ú®"
}

def get_regular_gacha_pool() -> Dict[str, Dict]:
    """üéØ L·∫•y pool gacha th∆∞·ªùng (exclude limited-only characters)"""
    regular_pool = {}
    for maid_id, template in MAID_TEMPLATES.items():
        # Exclude limited-only characters kh·ªèi gacha th∆∞·ªùng
        if not template.get("limited_only", False):
            regular_pool[maid_id] = template
    return regular_pool

def get_limited_banner_pool() -> Dict[str, Dict]:
    """üåü L·∫•y pool limited banner (include ALL characters)"""
    return MAID_TEMPLATES.copy()  # Limited banner c√≥ access t·∫•t c·∫£ characters

def get_featured_characters() -> List[str]:
    """‚≠ê L·∫•y danh s√°ch featured characters trong limited banner"""
    featured = []
    for maid_id, template in MAID_TEMPLATES.items():
        if template.get("banner_featured", False):
            featured.append(maid_id)
    return featured

def get_random_maid_regular_gacha() -> str:
    """üé∞ Roll maid t·ª´ regular gacha pool (exclude limited-only)"""
    regular_pool = get_regular_gacha_pool()
    
    # T·∫°o weighted list exclude limited characters
    weighted_maids = []
    for maid_id, template in regular_pool.items():
        rarity = template["rarity"]
        individual_rate = RARITY_CONFIG[rarity]["individual_rate"]
        weighted_maids.append((maid_id, individual_rate))
    
    # Random selection
    total_weight = sum(weight for _, weight in weighted_maids)
    rand = random.random() * total_weight
    current_weight = 0
    
    for maid_id, weight in weighted_maids:
        current_weight += weight
        if rand <= current_weight:
            return maid_id
    
    # Fallback
    regular_r_maids = [maid_id for maid_id, template in regular_pool.items() 
                       if template["rarity"] == "R"]
    return random.choice(regular_r_maids) if regular_r_maids else "tsunade_r"

def get_random_maid_limited_banner() -> str:
    """üåü Roll maid t·ª´ limited banner v·ªõi rate-up v√† featured"""
    if not LIMITED_BANNER_CONFIG["enabled"]:
        return get_random_maid_regular_gacha()  # Fallback to regular n·∫øu banner t·∫Øt
    
    featured_chars = get_featured_characters()
    rand = random.uniform(0, 100)
    
    # Determine rarity v·ªõi limited rates
    if rand <= LIMITED_RARITY_CONFIG["GR"]["total_rate"]:
        # GR tier - GHOST RARE!
        featured_grs = [maid_id for maid_id in featured_chars 
                       if MAID_TEMPLATES[maid_id]["rarity"] == "GR"]
        if featured_grs:
            return random.choice(featured_grs)
        
        # Fallback to UR if no GR available (shouldn't happen)
        regular_urs = [maid_id for maid_id, template in MAID_TEMPLATES.items() 
                       if template["rarity"] == "UR" and not template.get("limited_only", False)]
        return random.choice(regular_urs) if regular_urs else "rem_ur"
        
    elif rand <= LIMITED_RARITY_CONFIG["GR"]["total_rate"] + LIMITED_RARITY_CONFIG["UR"]["total_rate"]:
        # UR tier (no featured URs anymore, all Jalter moved to GR)
        regular_urs = [maid_id for maid_id, template in MAID_TEMPLATES.items() 
                       if template["rarity"] == "UR" and not template.get("limited_only", False)]
        return random.choice(regular_urs) if regular_urs else "rem_ur"
        
    elif rand <= (LIMITED_RARITY_CONFIG["GR"]["total_rate"] + 
                  LIMITED_RARITY_CONFIG["UR"]["total_rate"] + 
                  LIMITED_RARITY_CONFIG["SSR"]["total_rate"]):
        # SSR tier
        ssrs = [maid_id for maid_id, template in MAID_TEMPLATES.items() 
                if template["rarity"] == "SSR"]
        return random.choice(ssrs) if ssrs else "mikasa_ssr"
        
    elif rand <= (LIMITED_RARITY_CONFIG["GR"]["total_rate"] + 
                  LIMITED_RARITY_CONFIG["UR"]["total_rate"] + 
                  LIMITED_RARITY_CONFIG["SSR"]["total_rate"] + 
                  LIMITED_RARITY_CONFIG["SR"]["total_rate"]):
        # SR tier
        srs = [maid_id for maid_id, template in MAID_TEMPLATES.items() 
               if template["rarity"] == "SR"]
        return random.choice(srs) if srs else "usagi_sr"
    else:
        # R tier
        rs = [maid_id for maid_id, template in MAID_TEMPLATES.items() 
              if template["rarity"] == "R"]
        return random.choice(rs) if rs else "tsunade_r"

def is_limited_banner_active() -> bool:
    """üïê Check xem limited banner c√≥ ƒëang active kh√¥ng"""
    return LIMITED_BANNER_CONFIG["enabled"]

def get_limited_banner_info() -> Dict:
    """‚ÑπÔ∏è L·∫•y th√¥ng tin limited banner hi·ªán t·∫°i"""
    return {
        "enabled": LIMITED_BANNER_CONFIG["enabled"],
        "banner_name": LIMITED_BANNER_CONFIG["banner_name"],
        "description": LIMITED_BANNER_CONFIG["banner_description"],
        "featured_characters": get_featured_characters(),
        "single_cost": LIMITED_BANNER_CONFIG["single_roll_cost"],
        "ten_cost": LIMITED_BANNER_CONFIG["ten_roll_cost"],
        "ur_rate": LIMITED_RARITY_CONFIG["UR"]["total_rate"],
        "featured_rate": LIMITED_RARITY_CONFIG["UR"]["featured_rate"]
    }

def get_maid_template_safe(maid_id: str) -> Dict:
    """üõ°Ô∏è Safely get maid template with legacy support"""
    # Check if maid_id exists directly
    if maid_id in MAID_TEMPLATES:
        return MAID_TEMPLATES[maid_id]
    
    # Check legacy mapping
    if maid_id in LEGACY_MAID_MAPPING:
        new_maid_id = LEGACY_MAID_MAPPING[maid_id]
        if new_maid_id in MAID_TEMPLATES:
            return MAID_TEMPLATES[new_maid_id]
    
    # Return None if not found
    return None 

# üé™ MULTI-BANNER SYSTEM FUNCTIONS
def get_current_banner() -> str:
    """üéØ L·∫•y banner hi·ªán t·∫°i ƒëang active"""
    return ACTIVE_BANNER_CONFIG.get("current_banner", "kotori")

def set_active_banner(banner_id: str) -> bool:
    """üéØ Set banner active (admin command)"""
    if banner_id not in BANNER_CONFIGS:
        return False
    
    # Update active banner config
    ACTIVE_BANNER_CONFIG["current_banner"] = banner_id
    ACTIVE_BANNER_CONFIG["enabled"] = True
    
    # Update legacy config ƒë·ªÉ backward compatibility
    banner_config = BANNER_CONFIGS[banner_id]
    LIMITED_BANNER_CONFIG.update({
        "enabled": True,
        "banner_name": banner_config["banner_name"],
        "single_roll_cost": banner_config["single_roll_cost"],
        "ten_roll_cost": banner_config["ten_roll_cost"],
        "banner_description": banner_config["banner_description"],
        "background_color": banner_config["background_color"]
    })
    
    # Update featured characters
    featured_char = banner_config["featured_character"]
    for maid_id, template in MAID_TEMPLATES.items():
        # Reset t·∫•t c·∫£ featured flags
        if "banner_featured" in template:
            template["banner_featured"] = False
        
        # Set featured cho character ƒë∆∞·ª£c ch·ªçn
        if maid_id == featured_char:
            template["banner_featured"] = True
    
    return True

def disable_active_banner() -> bool:
    """üö´ T·∫Øt banner hi·ªán t·∫°i"""
    ACTIVE_BANNER_CONFIG["enabled"] = False
    LIMITED_BANNER_CONFIG["enabled"] = False
    
    # Reset t·∫•t c·∫£ featured flags
    for maid_id, template in MAID_TEMPLATES.items():
        if "banner_featured" in template:
            template["banner_featured"] = False
    
    return True

def get_banner_info(banner_id: str = None) -> Dict:
    """‚ÑπÔ∏è L·∫•y th√¥ng tin banner theo ID ho·∫∑c current banner"""
    if banner_id is None:
        banner_id = get_current_banner()
    
    if banner_id not in BANNER_CONFIGS:
        return None
    
    banner_config = BANNER_CONFIGS[banner_id]
    featured_char = banner_config["featured_character"]
    
    return {
        "banner_id": banner_id,
        "banner_name": banner_config["banner_name"],
        "description": banner_config["banner_description"],
        "featured_character": featured_char,
        "featured_name": MAID_TEMPLATES[featured_char]["name"],
        "featured_emoji": MAID_TEMPLATES[featured_char]["emoji"],
        "single_cost": banner_config["single_roll_cost"],
        "ten_cost": banner_config["ten_roll_cost"],
        "background_color": banner_config["background_color"],
        "theme_emoji": banner_config["theme_emoji"],
        "enabled": ACTIVE_BANNER_CONFIG["enabled"] and get_current_banner() == banner_id
    }

def get_all_banner_list() -> List[Dict]:
    """üìã L·∫•y danh s√°ch t·∫•t c·∫£ banners available"""
    banners = []
    for banner_id in BANNER_CONFIGS:
        banner_info = get_banner_info(banner_id)
        if banner_info:
            banners.append(banner_info)
    return banners

def get_random_maid_multi_banner() -> str:
    """üé∞ Roll maid t·ª´ multi-banner system"""
    if not ACTIVE_BANNER_CONFIG["enabled"]:
        return get_random_maid_regular_gacha()
    
    current_banner = get_current_banner()
    banner_config = BANNER_CONFIGS[current_banner]
    featured_char = banner_config["featured_character"]
    
    # GR featured = 0.05% rate (exclusive)
    rand = random.uniform(0, 100)
    
    if rand <= LIMITED_RARITY_CONFIG["GR"]["total_rate"]:
        # GHOST RARE! Featured character only
        return featured_char
        
    elif rand <= LIMITED_RARITY_CONFIG["GR"]["total_rate"] + LIMITED_RARITY_CONFIG["UR"]["total_rate"]:
        # UR tier (exclude limited-only characters)
        regular_urs = [maid_id for maid_id, template in MAID_TEMPLATES.items() 
                       if template["rarity"] == "UR" and not template.get("limited_only", False)]
        return random.choice(regular_urs) if regular_urs else "rem_ur"
        
    elif rand <= (LIMITED_RARITY_CONFIG["GR"]["total_rate"] + 
                  LIMITED_RARITY_CONFIG["UR"]["total_rate"] + 
                  LIMITED_RARITY_CONFIG["SSR"]["total_rate"]):
        # SSR tier
        ssrs = [maid_id for maid_id, template in MAID_TEMPLATES.items() 
                if template["rarity"] == "SSR"]
        return random.choice(ssrs) if ssrs else "mikasa_ssr"
        
    elif rand <= (LIMITED_RARITY_CONFIG["GR"]["total_rate"] + 
                  LIMITED_RARITY_CONFIG["UR"]["total_rate"] + 
                  LIMITED_RARITY_CONFIG["SSR"]["total_rate"] + 
                  LIMITED_RARITY_CONFIG["SR"]["total_rate"]):
        # SR tier
        srs = [maid_id for maid_id, template in MAID_TEMPLATES.items() 
               if template["rarity"] == "SR"]
        return random.choice(srs) if srs else "usagi_sr"
    else:
        # R tier
        rs = [maid_id for maid_id, template in MAID_TEMPLATES.items() 
              if template["rarity"] == "R"]
        return random.choice(rs) if rs else "tsunade_r"